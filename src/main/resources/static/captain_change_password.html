<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password</title>
    <style>
        /* General Body Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f4f4f4;
            text-align: center;
            background-image: url('Media.jpg'); /* Assuming Media.jpg is in the same directory */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            backdrop-filter: blur(6px);
            background-attachment: fixed;
            overflow: hidden; /* font-sans */
        }

        /* Container Card Styles */
        .card-container {
            width: 90%;
            max-width: 600px;
            padding-top: 20px;
            background: rgba(255, 255, 255, 0);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 450px;
            backdrop-filter: blur(10px) brightness(0.8) contrast(1.2);
            background-color: rgba(0, 0, 0, 0.4);
            display: flex; /* Use flexbox for container content */
            flex-direction: column; /* Stack children vertically */
            position: relative; /* Needed for absolute positioning of forms if used for fixed height */
            height: 50vh; /* Set a fixed height for the container, adjust as needed */
            max-height: 300px;  /* max-w-md */
        }

        /* Step Content Hiding */
        .step-content {
            display: none;
            margin-bottom: 1rem; /* space-y-4 equivalent for overall spacing */
        }

        /* Headings */
        h2 {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #f5f6f8; /* text-gray-800 */
            margin-bottom: 1rem; /* Added for spacing */
        }

        p {
            color: #f0f2f5; /* text-gray-600 */
            margin-bottom: 1rem; /* Added for spacing */
        }

        .text-green-600 {
            color: #0cf1a5;
        }
        
        .text-blue-600 { /* Added for links */
            color: #3b82f6;
        }

        .text-gray-700 {
            color: #374151;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .font-semibold {
            font-weight: 600;
        }

        /* Form Group (Label + Input) */
        .form-group {
            margin-bottom: 1rem; /* space-y-4 equivalent */
        }

        .form-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #f5f6f8; /* Changed for better contrast */
            margin-bottom: 0.25rem; /* mb-1 */
        }

        .form-input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: block;
            width: 60%;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.8);
            box-sizing: border-box;
            color: #333;
        }

        .form-input:focus {
            outline: 2px solid transparent; /* focus:outline-none */
            outline-offset: 2px;
            border-color: #3b82f6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 */
        }

        .text-center {
            text-align: center;
        }

        .tracking-widest {
            letter-spacing: 0.1em; /* tracking-widest */
        }

        .text-lg {
            font-size: 1.125rem;
        }

        /* Buttons */
        .btn {
            display: block;
            width: 60%;
            margin: 10px auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color:rgb(234, 136, 56);
            color: black;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            border: none;
            font-weight: bold;
        }

        .btn:disabled {
            opacity: 0.5; /* disabled:opacity-50 */
            cursor: not-allowed; /* disabled:cursor-not-allowed */
        }

        .btn-primary {
            background-color: #ea580c; /* bg-blue-600 */
            color: #ffffff; /* text-white */
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #f97316; /* hover:bg-blue-700 */
        }

        .btn-primary:focus:not(:disabled) {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5), 0 0 0 4px rgba(59, 130, 246, 0.5); /* focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 */
        }

        /* Loading Spinner */
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-spinner {
            height: 1.25rem; /* h-5 */
            width: 1.25rem; /* w-5 */
            margin-right: 0.75rem; /* mr-3 */
            color: #ffffff; /* text-white */
        }

        .hidden {
            display: none;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        /* Message Display */
        #messageDisplay {
            margin-top: 1rem; /* mt-4 */
            text-align: center; /* text-center */
            font-size: 0.875rem; /* text-sm */
        }

        .text-red-600 {
            color: #dc2626; /* text-red-600 */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-100 p-4 font-sans">
    <div class="card-container">
        <div id="step1" class="step-content">
            <h2>Change Your Password</h2>
            <p>Enter your current password and your new password.</p>
            <div class="form-group">
                <label for="current-password" class="form-label">Current Password</label>
                <input
                    type="password"
                    id="current-password"
                    class="form-input"
                    placeholder="Enter current password"
                />
            </div>
            <div class="form-group">
                <label for="new-password" class="form-label">New Password</label>
                <input
                    type="password"
                    id="new-password"
                    class="form-input"
                    placeholder="Enter new password"
                />
            </div>
            <div class="form-group">
                <label for="confirm-password" class="form-label">Confirm New Password</label>
                <input
                    type="password"
                    id="confirm-password"
                    class="form-input"
                    placeholder="Confirm new password"
                />
            </div>
            <button
                id="submitChangePasswordBtn"
                class="btn btn-primary"
            >
                <span id="submitChangePasswordBtnText">Change Password</span>
                <div id="submitChangePasswordLoading" class="hidden flex items-center justify-center">
                    <svg class="animate-spin loading-spinner" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Changing...
                </div>
            </button>
        </div>

        <div id="step2" class="step-content text-center">
            <h2 class="text-3xl font-bold text-green-600">Password Changed Successfully!</h2>
            <p class="text-lg text-gray-700">You will be redirected to the home page shortly.</p>
            <p class="text-sm text-gray-500">
                (If you are not redirected, <a href="user_home.html" class="text-blue-600 hover:underline">click here</a> to go to the home page.)
            </p>
        </div>

        <p id="messageDisplay"></p>
    </div>

    <script>
        // DOM Elements
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');

        const currentPasswordInput = document.getElementById('current-password');
        const newPasswordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const submitChangePasswordBtn = document.getElementById('submitChangePasswordBtn');
        const submitChangePasswordBtnText = document.getElementById('submitChangePasswordBtnText');
        const submitChangePasswordLoading = document.getElementById('submitChangePasswordLoading');

        const messageDisplay = document.getElementById('messageDisplay');

        // State variables
        let currentStep = 1;
        let message = '';
        let isLoading = false;

        /**
         * Updates the UI based on the current step and loading state.
         */
        function updateUI() {
            // Hide all steps first
            step1.style.display = 'none';
            step2.style.display = 'none';

            // Show the current step
            switch (currentStep) {
                case 1:
                    step1.style.display = 'block';
                    break;
                case 2:
                    step2.style.display = 'block';
                    break;
            }

            // Update message display
            messageDisplay.textContent = message;
            if (message.includes('success') || message.includes('changed successfully')) {
                messageDisplay.classList.remove('text-red-600');
                messageDisplay.classList.add('text-green-600');
            } else if (message) {
                messageDisplay.classList.remove('text-green-600');
                messageDisplay.classList.add('text-red-600');
            } else {
                messageDisplay.classList.remove('text-green-600', 'text-red-600');
            }

            // Handle loading states for buttons and inputs
            currentPasswordInput.disabled = isLoading;
            newPasswordInput.disabled = isLoading;
            confirmPasswordInput.disabled = isLoading;
            submitChangePasswordBtn.disabled = isLoading;
            submitChangePasswordBtnText.style.display = isLoading ? 'none' : 'block';
            submitChangePasswordLoading.style.display = isLoading ? 'flex' : 'none';
        }

        /**
         * Handles the password change submission.
         */
        async function handleChangePassword() {
            isLoading = true;
            message = '';
            updateUI();

            const currentPassword = currentPasswordInput.value;
            const newPassword = newPasswordInput.value;
            const confirmNewPassword = confirmPasswordInput.value;

            if (!currentPassword || !newPassword || !confirmNewPassword) {
                message = 'Please fill in all password fields.';
                isLoading = false;
                updateUI();
                return;
            }

            // Basic validation for new password
            if (newPassword.length < 6) {
                message = 'New password must be at least 6 characters long.';
                isLoading = false;
                updateUI();
                return;
            }

            if (newPassword !== confirmNewPassword) {
                message = 'New passwords do not match. Please try again.';
                isLoading = false;
                updateUI();
                return;
            }

            // Optional: Prevent new password from being the same as the current password
            if (currentPassword === newPassword) {
                message = 'New password cannot be the same as the current password.';
                isLoading = false;
                updateUI();
                return;
            }

            const userData = {
                // In a real application, you'd typically get the user's ID
                // from an authenticated session (e.g., from a JWT token).
                // For this example, we'll assume the user ID is available or inferred on the backend.
                // You might also send the user's email if that's how you identify them for this API.
                currentPassword: currentPassword,
                newPassword: newPassword
            };

            try {
                // IMPORTANT: Replace '/api/users/{userId}/change-password' with your actual API endpoint
                // and ensure it correctly handles current password verification.
                // The backend endpoint should look something like: PUT /api/users/{id}/password or POST /api/auth/change-password
                // This example assumes a PUT request to update the user, including password.
                // If you have a specific /change-password endpoint, use that.

                // This example sends the current password and new password to the backend for verification and update.
                const response = await fetch('/api/users/change-password', { // Adjust this URL to your actual backend endpoint
                    method: 'POST', // Or PUT, depending on your backend
                    headers: {
                        'Content-Type': 'application/json',
                        // 'Authorization': 'Bearer YOUR_AUTH_TOKEN' // In a real app, send auth token
                    },
                    body: JSON.stringify(userData),
                });

                const apiResponse = await response.json(); // Assuming your backend returns ApiResponse

                if (response.ok) { // Check for 2xx status codes
                    message = 'Password has been changed successfully! Redirecting to home page...';
                    currentStep = 2; // Transition to success step
                    updateUI();

                    // Redirect after a short delay
                    setTimeout(() => {
                        window.location.href = 'user_home.html'; // Redirect to user home or login page
                    }, 2000);
                } else {
                    // Handle API errors (e.g., invalid current password, weak new password)
                    message = apiResponse.message || 'Failed to change password. Please try again.';
                    isLoading = false;
                    updateUI();
                }
            } catch (error) {
                console.error('Error changing password:', error);
                message = `Network error or unexpected issue: ${error.message}`;
                isLoading = false;
                updateUI();
            }
        }

        // Event Listeners
        submitChangePasswordBtn.addEventListener('click', handleChangePassword);

        // Initial UI render
        updateUI();
    </script>
</body>
</html>