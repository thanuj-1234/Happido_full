<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password</title>
    <style>
        /* General Body Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f4f4f4;
            text-align: center;
            background-image: url('Media.jpg'); /* Assuming Media.jpg is in the same directory */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            backdrop-filter: blur(6px);
            background-attachment: fixed;
            overflow: hidden; /* font-sans */
        }

        /* Container Card Styles */
        .card-container {
            width: 90%;
            max-width: 600px;
            
            padding-top: 20px;

            background: rgba(255, 255, 255, 0);
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 450px;
            backdrop-filter: blur(10px) brightness(0.8) contrast(1.2);
            background-color: rgba(0, 0, 0, 0.4);
            display: flex; /* Use flexbox for container content */
            flex-direction: column; /* Stack children vertically */
            position: relative; /* Needed for absolute positioning of forms if used for fixed height */
            height: 50vh; /* Set a fixed height for the container, adjust as needed */
            max-height: 300px;  /* max-w-md */
        }

        /* Step Content Hiding */
        .step-content {
            display: none;
            margin-bottom: 1rem; /* space-y-4 equivalent for overall spacing */
        }

        /* Headings */
        h2 {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #f5f6f8; /* text-gray-800 */
            margin-bottom: 1rem; /* Added for spacing */
        }

        p {
            color: #f0f2f5; /* text-gray-600 */
            margin-bottom: 1rem; /* Added for spacing */
        }

        .text-green-600 {
            color: #0cf1a5;
        }

        

        .text-gray-700 {
            color: #374151;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .text-lg {
            font-size: 1.125rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .font-semibold {
            font-weight: 600;
        }

        /* Form Group (Label + Input) */
        .form-group {
            margin-bottom: 1rem; /* space-y-4 equivalent */
        }

        .form-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #374151; /* text-gray-700 */
            margin-bottom: 0.25rem; /* mb-1 */
        }

        .form-input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: block;
            width: 60%;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.8);
            box-sizing: border-box;
            color: #333;
        }

        .form-input:focus {
            outline: 2px solid transparent; /* focus:outline-none */
            outline-offset: 2px;
            border-color: #3b82f6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); /* focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 */
        }

        .text-center {
            text-align: center;
        }

        .tracking-widest {
            letter-spacing: 0.1em; /* tracking-widest */
        }

        .text-lg {
            font-size: 1.125rem;
        }

        /* Buttons */
        .btn {
            display: block;
            width: 60%;
            margin: 10px auto;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color:rgb(234, 136, 56);
            color: black;
            cursor: pointer;
            font-size: 16px;
            transition: 0.3s;
            border: none;
            font-weight: bold;
        }

        .btn:disabled {
            opacity: 0.5; /* disabled:opacity-50 */
            cursor: not-allowed; /* disabled:cursor-not-allowed */
        }

        .btn-primary {
            background-color: #ea580c; /* bg-blue-600 */
            color: #ffffff; /* text-white */
        }

        .btn-primary:hover:not(:disabled) {
            background-color: #f97316; /* hover:bg-blue-700 */
        }

        .btn-primary:focus:not(:disabled) {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5), 0 0 0 4px rgba(59, 130, 246, 0.5); /* focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 */
        }

        .btn-secondary {
            color: #2563eb; /* text-blue-600 */
            background-color: transparent;
        }

        .btn-secondary:hover:not(:disabled) {
            color: #1e40af; /* hover:text-blue-800 */
        }

        .btn-gray {
            margin-top: 1.5rem; /* mt-6 */
            background-color: #e5e7eb; /* bg-gray-200 */
            color: #1f2937; /* text-gray-800 */
        }

        .btn-gray:hover:not(:disabled) {
            background-color: #d1d5db; /* hover:bg-gray-300 */
        }

        .btn-gray:focus:not(:disabled) {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(156, 163, 175, 0.5), 0 0 0 4px rgba(156, 163, 175, 0.5); /* focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 */
        }

        /* Loading Spinner */
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-spinner {
            height: 1.25rem; /* h-5 */
            width: 1.25rem; /* w-5 */
            margin-right: 0.75rem; /* mr-3 */
            color: #ffffff; /* text-white */
        }

        .hidden {
            display: none;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-center {
            justify-content: center;
        }

        /* Message Display */
        #messageDisplay {
            margin-top: 1rem; /* mt-4 */
            text-align: center; /* text-center */
            font-size: 0.875rem; /* text-sm */
        }

        .text-red-600 {
            color: #dc2626; /* text-red-600 */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-gray-100 p-4 font-sans">
    <div class="card-container">
        <div id="step1" class="step-content">
            <h2>Forgot Your Password?</h2>
            <p>Enter your email address to receive a verification code.</p>
            <div class="form-group">
                <label for="email" class="form-label">Email Address</label>
                <input
                    type="email"
                    id="email"
                    class="form-input"
                    placeholder="you@example.com"
                />
            </div>
            <button
                id="sendOtpBtn"
                class="btn btn-primary"
            >
                <span id="sendOtpBtnText">Send OTP</span>
                <div id="sendOtpLoading" class="hidden flex items-center justify-center">
                    <svg class="animate-spin loading-spinner" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Sending OTP...
                </div>
            </button>
        </div>

        <div id="step2" class="step-content">
            <h2>Verify Your Email</h2>
            <p>A 6-digit code has been sent to <span id="emailDisplay" class="font-semibold text-blue-600"></span>. Please enter it below.</p>
            <div class="form-group">
                <label for="otp" class="form-label">Verification Code</label>
                <input
                    type="text"
                    id="otp"
                    class="form-input text-center tracking-widest text-lg"
                    placeholder="------"
                    maxlength="6"
                />
            </div>
            <button
                id="verifyOtpBtn"
                class="btn btn-primary"
            >
                <span id="verifyOtpBtnText">Verify OTP</span>
                <div id="verifyOtpLoading" class="hidden flex items-center justify-center">
                    <svg class="animate-spin loading-spinner" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Verifying...
                </div>
            </button>
            <button
                id="resendOtpBtn"
                class="btn btn-secondary"
            >
                Resend OTP or Change Email
            </button>
        </div>

        <div id="step3" class="step-content">
            <h2>Set New Password</h2>
            <p>Enter your new password below.</p>
            <div class="form-group">
                <label for="new-password" class="form-label">New Password</label>
                <input
                    type="password"
                    id="new-password"
                    class="form-input"
                    placeholder="Enter new password"
                />
            </div>
            <div class="form-group">
                <label for="confirm-password" class="form-label">Confirm New Password</label>
                <input
                    type="password"
                    id="confirm-password"
                    class="form-input"
                    placeholder="Confirm new password"
                />
            </div>
            <button
                id="submitNewPasswordBtn"
                class="btn btn-primary"
            >
                <span id="submitNewPasswordBtnText">Submit</span>
                <div id="submitNewPasswordLoading" class="hidden flex items-center justify-center">
                    <svg class="animate-spin loading-spinner" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Submitting...
                </div>
            </button>
        </div>

        <div id="step4" class="step-content text-center">
            <h2 class="text-3xl font-bold text-green-600">Password Reset Successful!</h2>
            <p class="text-lg text-gray-700">You will be redirected to the home page shortly.</p>
            <p class="text-sm text-gray-500">
                (If you are not redirected, <a href="user_home.html" class="text-blue-600 hover:underline">click here</a> to go to the home page.)
            </p>
        </div>

        <p id="messageDisplay"></p>
    </div>

    <script>
        // DOM Elements
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const step3 = document.getElementById('step3');
        const step4 = document.getElementById('step4');

        const emailInput = document.getElementById('email');
        const sendOtpBtn = document.getElementById('sendOtpBtn');
        const sendOtpBtnText = document.getElementById('sendOtpBtnText');
        const sendOtpLoading = document.getElementById('sendOtpLoading');

        const emailDisplay = document.getElementById('emailDisplay');
        const otpInput = document.getElementById('otp');
        const verifyOtpBtn = document.getElementById('verifyOtpBtn');
        const verifyOtpBtnText = document.getElementById('verifyOtpBtnText');
        const verifyOtpLoading = document.getElementById('verifyOtpLoading');
        const resendOtpBtn = document.getElementById('resendOtpBtn');

        const newPasswordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const submitNewPasswordBtn = document.getElementById('submitNewPasswordBtn');
        const submitNewPasswordBtnText = document.getElementById('submitNewPasswordBtnText');
        const submitNewPasswordLoading = document.getElementById('submitNewPasswordLoading');

        const startOverBtn = document.getElementById('startOverBtn'); // This button is removed from step 4 for direct redirect
        const messageDisplay = document.getElementById('messageDisplay');

        // State variables
        let currentStep = 1;
        let email = '';
        let otp = '';
        let newPassword = '';
        let confirmPassword = '';
        let message = '';
        let simulatedOtp = '';
        let isLoading = false;

        /**
         * Updates the UI based on the current step and loading state.
         */
        function updateUI() {
            // Hide all steps first
            step1.style.display = 'none';
            step2.style.display = 'none';
            step3.style.display = 'none';
            step4.style.display = 'none';

            // Show the current step
            switch (currentStep) {
                case 1:
                    step1.style.display = 'block';
                    break;
                case 2:
                    step2.style.display = 'block';
                    emailDisplay.textContent = email; // Update email in OTP step
                    break;
                case 3:
                    step3.style.display = 'block';
                    break;
                case 4:
                    step4.style.display = 'block';
                    // No need for startOverBtn in step 4 as it will redirect
                    break;
            }

            // Update message display
            messageDisplay.textContent = message;
            if (message.includes('success') || message.includes('reset successfully')) {
                messageDisplay.classList.remove('text-red-600');
                messageDisplay.classList.add('text-green-600');
            } else if (message) {
                messageDisplay.classList.remove('text-green-600');
                messageDisplay.classList.add('text-red-600');
            } else {
                messageDisplay.classList.remove('text-green-600', 'text-red-600');
            }

            // Handle loading states for buttons and inputs
            emailInput.disabled = isLoading;
            sendOtpBtn.disabled = isLoading;
            sendOtpBtnText.style.display = isLoading ? 'none' : 'block';
            sendOtpLoading.style.display = isLoading ? 'flex' : 'none';

            otpInput.disabled = isLoading;
            verifyOtpBtn.disabled = isLoading;
            verifyOtpBtnText.style.display = isLoading ? 'none' : 'block';
            verifyOtpLoading.style.display = isLoading ? 'flex' : 'none';
            resendOtpBtn.disabled = isLoading;

            newPasswordInput.disabled = isLoading;
            confirmPasswordInput.disabled = isLoading;
            submitNewPasswordBtn.disabled = isLoading;
            submitNewPasswordBtnText.style.display = isLoading ? 'none' : 'block';
            submitNewPasswordLoading.style.display = isLoading ? 'flex' : 'none';
        }

        /**
         * Handles sending the OTP to the provided email.
         */
        async function handleSendOtp() {
            isLoading = true;
            message = '';
            updateUI();

            email = emailInput.value.trim();

            // Basic email validation
            if (!email || !email.includes('@') || !email.includes('.')) {
                message = 'Please enter a valid email address.';
                isLoading = false;
                updateUI();
                return;
            }

            // Simulate API call to send OTP
            await new Promise(resolve => setTimeout(resolve, 1500));

            // Generate a random 6-digit OTP for simulation
            simulatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
            alert(`OTP sent to ${email}. Simulated OTP: ${simulatedOtp}`);
            
            currentStep = 2;
            isLoading = false;
            updateUI();
        }

        /**
         * Handles OTP verification.
         */
        async function handleVerifyOtp() {
            isLoading = true;
            message = '';
            updateUI();

            otp = otpInput.value.trim();

            if (!otp) {
                message = 'Please enter the OTP.';
                isLoading = false;
                updateUI();
                return;
            }

            // Simulate API call to verify OTP
            await new Promise(resolve => setTimeout(resolve, 1500));

            if (otp === simulatedOtp) {
                message = 'OTP verified successfully!';
                currentStep = 3;
            } else {
                message = 'Invalid OTP. Please try again.';
            }
            isLoading = false;
            updateUI();
        }

        /**
         * Handles setting the new password and confirming it.
         */
        async function handleSubmitNewPassword() {
            isLoading = true;
            message = '';
            updateUI();

            newPassword = newPasswordInput.value;
            confirmPassword = confirmPasswordInput.value;

            if (!newPassword || !confirmPassword) {
                message = 'Please fill in both password fields.';
                isLoading = false;
                updateUI();
                return;
            }

            if (newPassword.length < 6) {
                message = 'Password must be at least 6 characters long.';
                isLoading = false;
                updateUI();
                return;
            }

            if (newPassword !== confirmPassword) {
                message = 'Passwords do not match. Please try again.';
                isLoading = false;
                updateUI();
                return;
            }

            // Simulate API call to reset password
            await new Promise(resolve => setTimeout(resolve, 1500));

            message = 'Password has been reset successfully! Redirecting to home page...';
            isLoading = false;
            updateUI();

            // Actual redirection to home page after a short delay
            setTimeout(() => {
                window.location.href = 'index.html'; // <<< THIS IS THE KEY CHANGE
            }, 2000);
        }

        /**
         * Resets the flow to the initial email input step.
         */
        function handleStartOver() {
            currentStep = 1;
            email = '';
            otp = '';
            newPassword = '';
            confirmPassword = '';
            message = '';
            simulatedOtp = '';
            isLoading = false;
            emailInput.value = ''; // Clear email input
            otpInput.value = ''; // Clear OTP input
            newPasswordInput.value = ''; // Clear new password input
            confirmPasswordInput.value = ''; // Clear confirm password input
            updateUI();
        }

        // Event Listeners
        sendOtpBtn.addEventListener('click', handleSendOtp);
        verifyOtpBtn.addEventListener('click', handleVerifyOtp);
        submitNewPasswordBtn.addEventListener('click', handleSubmitNewPassword);
        resendOtpBtn.addEventListener('click', handleStartOver); // Resend/Change Email goes back to step 1
        // The startOverBtn is removed from step 4, so no event listener for it here.

        // Initial UI render
        updateUI();
    </script>
</body>
</html>